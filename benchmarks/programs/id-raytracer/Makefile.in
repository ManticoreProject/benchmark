# Makefile for raytracer benchmarks
#
# @configure_input@
#

SHELL =		/bin/sh

SMLNJ =		@SMLNJ_CMD@
MLTON =		@MLTON@
PMLC =		@PMLC@
PMLCFLAGS=@PMLCFLAGS@

TARGET =	id-raytracer

all:		$(TARGET)-par $(TARGET)-seq-elison $(TARGET)-seq $(TARGET)-smlnj  $(TARGET)-mlton

$(TARGET)-par:	raytracer-par.mlb raytracer-par.pml
	../../scripts/set-max-leaf-size.sh 4
	$(PMLC) $(PMLCFLAGS) -o $(TARGET)-par raytracer-par.mlb
	../../scripts/restore-max-leaf-size.sh

$(TARGET)-seq-elison:	raytracer-par.mlb raytracer-par.pml
	$(PMLC) $(PMLCFLAGS) -o $(TARGET)-seq-elison raytracer-par.mlb

$(TARGET)-seq:	raytracer-seq.mlb raytracer-seq.pml
	$(PMLC) $(PMLCFLAGS) -Csequential=true -o $(TARGET)-seq raytracer-seq.mlb

$(TARGET)-smlnj:	raytracer.cm raytracer.sml
	echo "SMLofNJ.exportFn(\"id-raytracer-smlnj\", Main.main);" | $(SMLNJ) raytracer.cm

$(TARGET)-mlton:	raytracer-mlton.mlb raytracer.sml
	$(MLTON) -output $(TARGET)-mlton raytracer-mlton.mlb

.PHONY: clean
clean:
	rm -rf $(TARGET)-par $(TARGET)-seq-elison $(TARGET)-seq  $(TARGET)-mlton  *.s out.ppm .cm *.x86-linux

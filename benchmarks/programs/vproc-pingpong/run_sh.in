#!/bin/bash

PATH_TO_SWP=$1
PATH_TO_TRUNK=$2

NAME="vproc-pingpong"
DESCRIPTION="synthetic benchmark: signals are repeatedly exchanged between two vprocs"

## Parameters provided by the configure script

# number of times to test each data point; for statistical validity
NUM_TRIALS="@NUM_TRIALS@"
MANTI_BENCH_ROOT=@MANTI_BENCH_ROOT@

NUM_PINGPONGS="10000 100000 1000000"

$PATH_TO_SWP/bin/pmlc $PMLCFLAGS -o vproc-pingpong-swp vproc-pingpong.mlb
$PATH_TO_TRUNK/bin/pmlc $PMLCFLAGS -o vproc-pingpong-trunk vproc-pingpong-trunk.mlb

## run the experiment for the swp branch

for i in $NUM_PINGPONGS; do
    for proc_config in "-dense" "-sparse"; do
	echo "$i $proc_config"
	$MANTI_BENCH_ROOT/scripts/experiment.sh -p 2 -f vproc-pingpong-swp -n "$NAME" -d "$DESCRIPTION" -t $NUM_TRIALS -r $PATH_TO_SWP -s "$i $proc_config"
	$MANTI_BENCH_ROOT/scripts/experiment.sh -p 2 -f vproc-pingpong-trunk -n "$NAME" -d "$DESCRIPTION" -t $NUM_TRIALS -r $PATH_TO_TRUNK -s "$i $proc_config"
    done
done
#!/bin/bash

PATH_TO_SWP=$1
PATH_TO_TRUNK=$2
NAME=$3
DESCRIPTION=$4

# number of times to test each data point; for statistical validity
NUM_TRIALS="@NUM_TRIALS@"
MANTI_BENCH_ROOT=@MANTI_BENCH_ROOT@
PMLCFLAGS="@PMLCFLAGS@"

$PATH_TO_SWP/bin/pmlc $PMLCFLAGS -o pmergesort-par-swp  pmergesort.mlb
$PATH_TO_TRUNK/bin/pmlc $PMLCFLAGS -o pmergesort-par-trunk pmergesort.mlb

for i in 100 1000 10000 100000 1000000; do
    (
	cd ../common
	rm random-int-list.txt                  # important: must remove the data first, ow the gen-bodies will leave the data as is
	./gen-random-int-list.sh $i
    )
    $MANTI_BENCH_ROOT/scripts/experiment.sh -p @NUM_PROCS@ -f pmergesort-par-swp -n "$NAME" -d "$DESCRIPTION" -t $NUM_TRIALS -r $PATH_TO_SWP -i $i
    $MANTI_BENCH_ROOT/scripts/experiment.sh -p @NUM_PROCS@ -f pmergesort-par-trunk -n "$NAME" -d "$DESCRIPTION" -t $NUM_TRIALS -r $PATH_TO_TRUNK -i $i
done

(
cd ../common
rm random-int-list.txt
svn up random-int-list.txt
)